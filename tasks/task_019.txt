# Task ID: 19
# Title: Supabase Auth Integration with Postmark
# Status: done
# Dependencies: 17, 18
# Priority: high
# Description: Configure Supabase to use Postmark for authentication emails and customize templates for email confirmation, password reset, and magic links.
# Details:
1. Update Supabase configuration to use Postmark as the email provider
2. Create custom email templates for:
   - Email confirmation
   - Password reset
   - Magic link authentication
3. Implement secure credential management to replace "graceful2025" default pattern
4. Configure email sender identity for authentication emails
5. Set up proper redirect URLs for authentication flows
6. Implement custom handlers for authentication events
7. Add logging for authentication email events

```typescript
// Example Supabase configuration for Postmark
import { createClient } from '@supabase/supabase-js';

// Initialize Supabase client
const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;
const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;
const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;

// Client for public operations
export const supabase = createClient(supabaseUrl, supabaseAnonKey);

// Admin client for server-side operations
export const supabaseAdmin = createClient(supabaseUrl, supabaseServiceKey);

// Configure email templates via Supabase dashboard or API
async function configureAuthEmailTemplates() {
  // This would typically be done through the Supabase dashboard
  // or using their management API
  
  // Example of how to update auth email templates programmatically
  // (if supported by Supabase API)
  await supabaseAdmin.auth.updateConfig({
    email_templates: {
      invite: {
        subject: 'Join Graceful Homeschooling',
        content: '...' // MJML template converted to HTML
      },
      confirmation: {
        subject: 'Confirm Your Graceful Homeschooling Account',
        content: '...' // MJML template converted to HTML
      },
      recovery: {
        subject: 'Reset Your Graceful Homeschooling Password',
        content: '...' // MJML template converted to HTML
      },
      magic_link: {
        subject: 'Your Magic Link to Graceful Homeschooling',
        content: '...' // MJML template converted to HTML
      }
    }
  });
}
```

# Test Strategy:
1. Test complete authentication flows (registration, password reset, magic link)
2. Verify emails are sent through Postmark with correct templates
3. Test email deliverability to various email providers
4. Validate all links in authentication emails work correctly
5. Test secure credential management with various password patterns
6. Verify proper error handling for authentication failures
